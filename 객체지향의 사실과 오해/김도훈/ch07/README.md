# 함께 모으기

> 코드와 모델을 밀접하게 연관시키는 것은 코드에 의미를 부여하고 모델을 적절하게 한다.
> 

객체지향 설계 안에 존재하는 세 가지 상호 연관된 관점

1. **개념 관점 (Conceptual Perspective)** : 설계는 도메인 안에 존재하는 개념과 개념들 사이의 관계를 표현한다. 이 관점은 사용자가 도메인을 바라보는 관점을 반영한다. 따라서 실제 도메인의 규칙과 제약을 최대한 유사하게 반영하는 것이 핵심이다.
2. **명세 관점 (Specification Perspective)** : 사용자의 영역인 도메인을 벗어나 개발자의 영역인 소프트웨어로 초점이 옮겨진다. 도메인이 아니라 실제로 소프트웨어 안에서 살아 숨쉬는 객체들의 책임에 초점을 맞추게 된다. 즉, 객체의 인터페이스를 바라보게 된다.
3. **구현 관점 (Implementation Perspective)** : 프로그래머인 우리에게 가장 익숙한 관점으로, 실제 작업을 수행하는 코드와 연관돼 있다. 구현 관점의 초점은 객체들이 책임을 수행하는 데 필요한 동작하는 코드를 작성하는 것이다.

동일한 클래스를 세 가지의 관점에서 바라보며, 클래스는 세 가지 관점을 통해 설계와 관련된 다양한 측면을 드러낼 수 있다.

- **개념 관점** : 클래스가 은유하는 개념은 **도메인** 관점을 반영한다.
- **명세 관점** : 클래스의 **공용 인터페이스**는 명세 관점을 반영한다.
- **구현 관점** : 클래스의 **속성과 메서드**는 구현 관점을 반영한다.

이것은 클래스를 어떻게 설계해야 하느냐에 대한 중요한 힌트를 암시하며, 클래스는 세 가지 관점을 모두 수용할 수 있도록 개념, 인터페이스, 구현을 함께 드러내야 한다. 동시에 코드 안에서 세 가지 관점을 쉽게 식별할 수 있도록 깔끔하게 분리해야 한다.

협력 안에서 메시지를 선택하고 메시지를 수신할 객체를 선택하는 것은 객체의 인터페이스, 즉 명세 관점에서 객체를 바라보는 것이다.

## 커피 전문점 도메인

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0a08179c-6898-4f98-8b89-2a2ddd15c8b3/5387f33d-1033-482a-940f-cb6ba4c71aa7/image.png)

- 손님 객체, 메뉴판 객체, 메뉴 항목 객체, 바리스타 객체, 커피 객체

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0a08179c-6898-4f98-8b89-2a2ddd15c8b3/5687f9c5-1b1e-4b2d-9270-3669f1e3160a/image.png)

메뉴 항목 객체는 메뉴판 객체에 포함되어 있다고 할 수 있는데 이것은 메뉴판 타입과 메뉴 항목 타입 간의 합성 관계로 단순화할 수 있다. 메뉴 항목의 4라는 숫자는 메뉴판에 포함되는 메뉴 항목이 4개라는 뜻이다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0a08179c-6898-4f98-8b89-2a2ddd15c8b3/576d535a-75a9-4f7d-880c-1759cdbc76d2/image.png)

손님 타입은 메뉴판 타입을 알고 있어야 원하는 커피를 선택할 수 있다. 메뉴판 타입은 손님의 일부가 아니므로 합성 관계는 아니고, 이 경우 타입들 사이를 단순한 선으로 연결한다. 이처럼 한 타입의 인스턴스가 다른 타입의 인스턴스를 포함하지는 않지만 서로 알고 있어야 할 경우 **연관 관계**라고 한다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0a08179c-6898-4f98-8b89-2a2ddd15c8b3/0a532791-1d24-445d-a86c-38eb599a397f/image.png)

위 그림은 커피 전문점 도메인을 구성하는 타입들의 종류와 관계를 표현한 것이다. 커피 제조와 관련된 객체들을 타입과 관계를 이용해 추상화한 일종의 모델이다. 이처럼 소프트웨어가 대상으로 하는 영역인 도메인을 단순화해서 표현한 모델을 **도메인 모델**이라고 한다.

커피 전문점이라는 도메인을 단순화해서 이해했으면 초점을 소프트웨어로 옮길 차례다. 협력을 설계하는 것이다. 즉, **적절한 객체에게 적절한 책임을 할당**하는 것이다.

> 실제로 도메인 모델을 작성하는 단계에서 어떤 관계가 포함 관계이고 어떤 관계가 연관 관계인지는 중요하지 않다. 초점은 **어떤 타입이 도메인을 구성하느냐**와 **타입들 사이에 어떤 관계가 존재하는지를 파악**함으로써 도메인을 이해하는 것이다.
> 

## 설계하고 구현하기

### 커피를 주문하기 위한 협력 찾기

협력을 설계할 때는 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하게 해야 한다. 즉, 메시지를 먼저 선택하고 그 후에 메시지를 수신하기에 적절한 객체를 선택해야 한다는 뜻이다. 이제 메시지를 **수신할 객체는** **메시지를 처리할 책임을 맡게 되고** 객체가 **수신하는 메시지는** **객체가 외부에 제공하는 공용 인터페이스에 포함**된다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0a08179c-6898-4f98-8b89-2a2ddd15c8b3/1a5f630d-4cf1-4b24-8fa3-60badcc5c239/image.png)

1. 커피를 주문하는 책임은 손님이 가장 적절하다.
2. 손님은 커피를 주문하기 위한 메뉴를 손님이 알고 있는 메뉴판에게 요청한다.
3. 메뉴를 알게 된 손님은 커피 제조 요청의 책임이 가장 적절한 바리스타에게 요청한다.
4. 커피 제조 요청을 받은 바리스타는 커피를 제조한다.

바리스타는 커피를 만드는 데 필요한 정보와 기술을 함께 구비하고 있는 전문가다. 커피를 만들기 위한 지식은 바리스타의 상태로, 기술은 바리스타의 행동으로 간주할 수 있다. 이런 관점에서 바리스타는 **스스로의 판단과 지식에 따라 행동하는 자율적인 존재**다.

### 인터페이스 정리하기

객체가 수신한 메시지가 객체의 인터페이스를 결정한다. 메시지가 객체를 선택했고, 선택된 객체는 메시지를 자신의 인터페이스로 받아들인다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/0a08179c-6898-4f98-8b89-2a2ddd15c8b3/2467cf8a-f6db-4e72-ad7b-d65c88aa6108/image.png)

소프트웨어의 구현은 동적인 객체가 아닌 정적인 타입을 이용해 이뤄진다. 따라서 객체들을 포괄하는 타입을 정의한 후 식별된 오퍼레이션을 타입의 인터페이스에 추가해야 한다.

- 타입 - 클래스
- 식별된 오퍼레이션 - 메서드

객체의 타입을 구현하는 일반적인 방법은 클래스를 이용하는 것이다. 협력을 통해 식별된 타입의 오퍼레이션은 **외부에서 접근 가능한 공용 인터페이스의 일부**이며, 외부에서 접근 가능하도록 공용(public)으로 선언돼 있어야 한다.

## 코드와 세 가지 관점

### 코드는 세 가지 관점을 모두 제공해야 한다.

1. 개념 관점에서 코드를 바라봤을 때
    - 소프트웨어 클래스가 도메인 개념의 특성을 최대한 수용하면 변경을 관리하기 쉽고 유지보수성을 향상시킬 수 있다.
    - 예를 들어, 커피를 제조하는 과정을 변경해야 한다면 어디를 변경해야 할까?
        - 현실에서 커피를 제조하는 사람은 바리스타다. 따라서 현실 세계와 동일하게 소프트웨어에서도 Barista 라는 클래스가 커피를 제조할 것이라고 쉽게 유추할 수 있다.
    - 소프트웨어 클래스와 도메인 클래스 사이의 간격이 좁으면 좁을수록 기능을 변경하기 위해 뒤적거려야 하는 코드의 양도 점점 줄어든다.
2. 명세 관점에서 코드를 바라봤을 때
    - 명세 관점은 클래스의 인터페이스를 바라본다. 클래스의 public 메서드는 다른 클래스가 협력할 수 있는 공용 인터페이스를 드러낸다.
    - 인터페이스를 수정하면 해당 객체와 협력하는 모든 객체에게 영향을 미칠 수밖에 없다. 때문에 객체의 인터페이스는 수정하기 어렵다.
    - 최대한 변화에 안정적인 인터페이스를 만들기 위해서는 인터페이스를 통해 구현과 관련된 세부 사항이 드러나지 않게 해야 한다.
3. 구현 관점에서 코드를 바라봤을 때
    - 구현 관점은 클래스의 내부 구현을 바라본다.
    - 클래스의 메서드와 속성은 구현에 속하며 공용 인터페이스의 일부가 아니다. 따라서 메서드의 구현과 속성의 변경은 원칙적으로 외부의 객체에게 영향을 미쳐서는 안 된다.
    - 이것은 메서드와 속성이 철저하게 클래스 내부로 캡슐화돼야 한다는 것을 의미한다.

### 도메인 개념을 참조하는 이유

어떤 메시지가 있을 때 그 메시지를 수신할 객체를 어떻게 선택하는가?

- 첫 번째 전략은 도메인 개념 중에서 가장 적절한 것을 선택하는 것이다.
    - 도메인 개념 안에서 적절한 객체를 선택하는 것은 도메인에 대한 지식을 기반으로 코드의 구조와 의미를 쉽게 유추할 수 있게 한다. 이것은 시스템의 유지보수성에 커다란 영향을 미친다.
